<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GitHub Repos Sunburst — chasenunez</title>
<style>
  body {{ font-family: Arial, Helvetica, sans-serif; margin: 0; padding: 12px; background: transparent; color:#222; }}
  #container {{ width: 1400px; max-width: 100%; margin: 0 auto; display: flex; gap: 20px; align-items: flex-start; }}
  #left, #right {{ flex: 1 1 0; min-width: 320px; }}
  #left {{ flex: 2 1 0; }}
  svg {{ width: 100%; height: 800px; display: block; }}
  .tooltip {{ position: absolute; pointer-events: none; background: rgba(0,0,0,0.75); color: white; padding: 6px 8px; border-radius: 4px; font-size: 12px; }}
  .label-small {{ font-size: 12px; color: #444; }}
  button {{ margin: 8px; }}
</style>
</head>
<body>
<h2>Repos &amp; languages — interactive visual (left: languages; right: commits)</h2>
<div id="container">
  <div id="left">
    <div id="chart"></div>
    <div id="label" class="label-small">Click a wedge to zoom / click center to reset.</div>
  </div>
  <div id="right">
    <div id="barchart"></div>
    <div id="barlabel" class="label-small">Repository commit counts (top by commits)</div>
  </div>
</div>

<!-- inlined data -->
<script id="flare-data" type="application/json">
{
  "children": [
    {
      "name": "byos_django",
      "children": [
        {
          "name": "Python",
          "size": 33966
        },
        {
          "name": "HTML",
          "size": 4385
        },
        {
          "name": "Dockerfile",
          "size": 474
        }
      ]
    },
    {
      "name": "chasenunez",
      "children": [
        {
          "name": "Python",
          "size": 65943997
        },
        {
          "name": "C",
          "size": 408938
        },
        {
          "name": "Cython",
          "size": 103945
        },
        {
          "name": "C++",
          "size": 85980
        },
        {
          "name": "Fortran",
          "size": 36224
        },
        {
          "name": "PowerShell",
          "size": 8834
        },
        {
          "name": "Smarty",
          "size": 8486
        },
        {
          "name": "JavaScript",
          "size": 8355
        },
        {
          "name": "Meson",
          "size": 4220
        },
        {
          "name": "Shell",
          "size": 2874
        }
      ]
    },
    {
      "name": "contribution_chart",
      "children": [
        {
          "name": "TypeScript",
          "size": 180801
        },
        {
          "name": "JavaScript",
          "size": 570
        }
      ]
    },
    {
      "name": "data_HUD",
      "children": [
        {
          "name": "JavaScript",
          "size": 11753
        },
        {
          "name": "HTML",
          "size": 3773
        },
        {
          "name": "CSS",
          "size": 1543
        }
      ]
    },
    {
      "name": "envidat_entrails",
      "children": [
        {
          "name": "HTML",
          "size": 19439431
        },
        {
          "name": "Python",
          "size": 28258
        }
      ]
    },
    {
      "name": "etani_shordul",
      "children": [
        {
          "name": "Python",
          "size": 1405
        }
      ]
    },
    {
      "name": "logue",
      "children": [
        {
          "name": "Python",
          "size": 28643
        }
      ]
    },
    {
      "name": "recursive_shrink",
      "children": [
        {
          "name": "Shell",
          "size": 2036
        }
      ]
    },
    {
      "name": "solar_nav",
      "children": [
        {
          "name": "Python",
          "size": 6409
        }
      ]
    },
    {
      "name": "sunburst_nav",
      "children": [
        {
          "name": "HTML",
          "size": 9941
        },
        {
          "name": "CSS",
          "size": 313
        }
      ]
    },
    {
      "name": "trmnlp",
      "children": [
        {
          "name": "JavaScript",
          "size": 41714
        },
        {
          "name": "Ruby",
          "size": 41108
        },
        {
          "name": "HTML",
          "size": 2789
        },
        {
          "name": "CSS",
          "size": 1111
        },
        {
          "name": "Shell",
          "size": 864
        },
        {
          "name": "Dockerfile",
          "size": 725
        },
        {
          "name": "Liquid",
          "size": 49
        }
      ]
    },
    {
      "name": "tui_log",
      "children": [
        {
          "name": "Rust",
          "size": 346478
        },
        {
          "name": "Makefile",
          "size": 1490
        }
      ]
    },
    {
      "name": "Private",
      "children": [
        {
          "name": "R",
          "size": 114370
        },
        {
          "name": "HTML",
          "size": 9253425
        },
        {
          "name": "TeX",
          "size": 285515
        },
        {
          "name": "Python",
          "size": 375905
        },
        {
          "name": "Rust",
          "size": 346478
        },
        {
          "name": "Makefile",
          "size": 1490
        },
        {
          "name": "JavaScript",
          "size": 78987
        },
        {
          "name": "CSS",
          "size": 75820
        },
        {
          "name": "SCSS",
          "size": 58439
        },
        {
          "name": "Shell",
          "size": 2768
        },
        {
          "name": "Jupyter Notebook",
          "size": 78593988
        },
        {
          "name": "Smalltalk",
          "size": 98772
        },
        {
          "name": "C#",
          "size": 19771
        },
        {
          "name": "C++",
          "size": 68
        },
        {
          "name": "PHP",
          "size": 53
        },
        {
          "name": "C",
          "size": 46
        }
      ]
    }
  ],
  "language_totals": [
    {
      "name": "Jupyter Notebook",
      "size": 78593988
    },
    {
      "name": "Python",
      "size": 66418583
    },
    {
      "name": "HTML",
      "size": 28713744
    },
    {
      "name": "Rust",
      "size": 692956
    },
    {
      "name": "C",
      "size": 408984
    },
    {
      "name": "TeX",
      "size": 285515
    },
    {
      "name": "TypeScript",
      "size": 180801
    },
    {
      "name": "JavaScript",
      "size": 141379
    },
    {
      "name": "R",
      "size": 114370
    },
    {
      "name": "Cython",
      "size": 103945
    },
    {
      "name": "Smalltalk",
      "size": 98772
    },
    {
      "name": "C++",
      "size": 86048
    },
    {
      "name": "CSS",
      "size": 78787
    },
    {
      "name": "SCSS",
      "size": 58439
    },
    {
      "name": "Ruby",
      "size": 41108
    },
    {
      "name": "Fortran",
      "size": 36224
    },
    {
      "name": "C#",
      "size": 19771
    },
    {
      "name": "PowerShell",
      "size": 8834
    },
    {
      "name": "Shell",
      "size": 8542
    },
    {
      "name": "Smarty",
      "size": 8486
    },
    {
      "name": "Meson",
      "size": 4220
    },
    {
      "name": "Makefile",
      "size": 2980
    },
    {
      "name": "Dockerfile",
      "size": 1199
    },
    {
      "name": "PHP",
      "size": 53
    },
    {
      "name": "Liquid",
      "size": 49
    }
  ],
  "commits": [
    {
      "name": "NASA-AIST",
      "commits": 1242
    },
    {
      "name": "log_cold_storage",
      "commits": 1001
    },
    {
      "name": "tui_log",
      "commits": 916
    },
    {
      "name": "log",
      "commits": 229
    },
    {
      "name": "star_date_eawag",
      "commits": 214
    },
    {
      "name": "contribution_chart",
      "commits": 213
    },
    {
      "name": "trmnlp",
      "commits": 134
    },
    {
      "name": "frictionless_eawag",
      "commits": 110
    },
    {
      "name": "baboon",
      "commits": 78
    },
    {
      "name": "dmp_select",
      "commits": 70
    },
    {
      "name": "logue",
      "commits": 69
    },
    {
      "name": "captains_log_eawag",
      "commits": 62
    },
    {
      "name": "data_HUD",
      "commits": 57
    },
    {
      "name": "chasenunez",
      "commits": 50
    },
    {
      "name": "NA.MASTIF",
      "commits": 37
    },
    {
      "name": "make_icsv_eawag",
      "commits": 33
    },
    {
      "name": "rdm_website_text",
      "commits": 32
    },
    {
      "name": "sunburst_nav",
      "commits": 27
    },
    {
      "name": "HPC",
      "commits": 20
    },
    {
      "name": "envidat_entrails",
      "commits": 17
    },
    {
      "name": "solar_nav",
      "commits": 17
    },
    {
      "name": "renku_rehydrate",
      "commits": 16
    },
    {
      "name": "etani_shordul",
      "commits": 15
    },
    {
      "name": "rdm_sunburst_eawag",
      "commits": 14
    },
    {
      "name": "cv",
      "commits": 12
    },
    {
      "name": "ETH_ULTRA",
      "commits": 10
    },
    {
      "name": "byos_django",
      "commits": 7
    },
    {
      "name": "recursive_shrink",
      "commits": 7
    },
    {
      "name": "tangleplot",
      "commits": 4
    },
    {
      "name": "chasenunez.github.io",
      "commits": 3
    },
    {
      "name": "arrowplot",
      "commits": 2
    },
    {
      "name": "2018.AOBP",
      "commits": 1
    }
  ]
}
</script>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
(function () {{
  // parse inlined JSON
  const raw = document.getElementById('flare-data').textContent;
  let data;
  try {{
    data = JSON.parse(raw);
  }} catch (e) {{
    console.error('Failed to parse inlined JSON', e);
    document.getElementById('label').textContent = 'Failed to load data.';
    return;
  }}

  // prepare aggregated language data (if available) or compute from children
  let languages = data.language_totals || (function() {{
    const m = {{}};
    (data.children||[]).forEach(repo => {{
      (repo.children||[]).forEach(lang => {{
        m[lang.name] = (m[lang.name] || 0) + (lang.size || 0);
      }});
    }});
    return Object.entries(m).map(([k,v]) => ({{name:k, size:v}})).sort((a,b)=>b.size-a.size);
  }})();

  const commits = data.commits || (data.commits_list || []);

  // LEFT: sunburst (languages)
  const leftWidth = 900, leftHeight = 800, leftRadius = Math.min(leftWidth, leftHeight)/2;
  const leftSvg = d3.select("#chart").append("svg")
    .attr("viewBox", [-leftWidth/2, -leftHeight/2, leftWidth, leftHeight]);

  // build a tiny hierarchy: root -> languages
  const langRoot = d3.hierarchy({name:'root', children: languages})
    .sum(d => d.size || 0);

  const partition = d3.partition().size([2*Math.PI, langRoot.height + 1]);
  partition(langRoot);

  // color scale using d3 scheme
  const color = d3.scaleOrdinal(d3.schemeTableau10);

  const arc = d3.arc()
    .startAngle(d => d.x0)
    .endAngle(d => d.x1)
    .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.01))
    .padRadius(leftRadius * 1.5)
    .innerRadius(d => d.y0 * (leftRadius / (d.depth+1)))
    .outerRadius(d => Math.max(d.y0 * (leftRadius / (d.depth+1)), d.y1 * (leftRadius / (d.depth+1))));

  const g = leftSvg.append("g");

  const slices = g.selectAll("path")
    .data(langRoot.descendants().slice(1))
    .join("path")
      .attr("d", d => arc(d))
      .attr("fill", d => color(d.data.name))
      .attr("stroke", "#fff")
      .attr("stroke-width", 1)
      .style("cursor", "pointer");

  slices.append("title").text(d => `${d.data.name}\n${d.value}`);

  // add labels only for top-level languages
  const labels = g.append("g")
    .attr("pointer-events", "none")
    .attr("text-anchor", "middle")
    .selectAll("text")
    .data(langRoot.children || [])
    .join("text")
      .attr("dy", "0.35em")
      .attr("transform", d => {{
        const x = (d.x0 + d.x1)/2 * 180 / Math.PI;
        const y = (d.y0 + d.y1)/2 * leftRadius / (d.depth+1);
        return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;
      }})
      .text(d => d.data.name)
      .style("font-size", "12px");

  // RIGHT: bar chart of commits
  const rightWidth = 500, rightHeight = 800;
  const rightSvg = d3.select("#barchart").append("svg")
    .attr("viewBox", [0, 0, rightWidth, rightHeight]);

  const commitsToShow = (commits || []).slice(0, 20); // top 20
  const margin = {top: 20, right: 10, bottom: 20, left: 140};
  const innerW = rightWidth - margin.left - margin.right;
  const innerH = rightHeight - margin.top - margin.bottom;

  const x = d3.scaleLinear().range([0, innerW]);
  const y = d3.scaleBand().range([0, innerH]).padding(0.1);

  x.domain([0, d3.max(commitsToShow, d => d.commits || 0) || 1]);
  y.domain(commitsToShow.map(d => d.name));

  const barG = rightSvg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);

  barG.selectAll("rect")
    .data(commitsToShow)
    .join("rect")
      .attr("y", d => y(d.name))
      .attr("height", y.bandwidth())
      .attr("x", 0)
      .attr("width", d => x(d.commits || 0))
      .attr("fill", "#4C78A8");

  barG.selectAll("text.label")
    .data(commitsToShow)
    .join("text")
      .attr("class", "label")
      .attr("x", -8)
      .attr("y", d => y(d.name) + y.bandwidth()/2)
      .attr("dy", "0.35em")
      .attr("text-anchor", "end")
      .text(d => d.name)
      .style("font-size", "12px");

  // x axis (counts) at bottom
  const xAxis = d3.axisBottom(x).ticks(4).tickFormat(d3.format("~s"));
  barG.append("g")
    .attr("transform", `translate(0,${innerH})`)
    .call(xAxis);

  // Done
}})();
</script>
</body>
</html>
